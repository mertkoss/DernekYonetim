@model IEnumerable<DernekYonetim.Models.Kaybettiklerimiz>
@{
    ViewData["Title"] = "Kaybettiklerimiz";
    Layout = "_Layout";
}

<section class="page-section bg-light" style="padding-top:120px">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="section-heading text-uppercase">Kaybettiklerimiz</h2>
            <h3 class="section-subheading text-muted">Aramızdan ayrılan değerli büyüklerimizi ve dostlarımızı saygıyla anıyoruz.</h3>

            @if (Context.Session.GetInt32("AdminID") != null)
            {
                <button class="btn btn-dark rounded-pill mt-3" data-bs-toggle="modal" data-bs-target="#kayipEkleModal">
                    <i class="fas fa-plus me-2"></i>Yeni Kayıt Ekle
                </button>
            }
        </div>

        <div class="row g-4">
            @foreach (var item in Model)
            {
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="card h-100 border-0 shadow-sm memorial-card">
                        <div class="img-wrapper">
                            <img src="@(string.IsNullOrEmpty(item.FotografYolu) ? "/img/default-profile.png" : item.FotografYolu)"
                                 class="card-img-top memorial-img" alt="@item.AdSoyad">
                        </div>
                        <div class="card-body text-center">
                            <h5 class="fw-bold mb-1">@item.AdSoyad</h5>
                            <p class="text-danger small mb-2">
                                <i class="fas fa-cross me-1"></i> @(item.VefatTarihi?.ToString("dd.MM.yyyy") ?? "---")
                            </p>
                            <p class="card-text text-muted small">@item.Aciklama</p>
                        </div>

                        @if (Context.Session.GetInt32("AdminID") != null)
                        {
                            <div class="card-footer bg-white border-0 text-center pb-3">
                                <button class="btn btn-sm btn-outline-warning border-0"
                                        onclick="kayipDuzenle(@item.Id,
                                                                    '@Html.Raw(item.AdSoyad?.Replace("'", "\\'"))',
                                                                    '@item.VefatTarihi?.ToString("yyyy-MM-dd")',
                                                                    '@Html.Raw(item.Aciklama?.Replace("'", "\\'").Replace("\r\n", " ").Replace("\n", " "))')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <a href="/Kayiplar/Sil/@item.Id" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Bu kaydı silmek istediğinize emin misiniz?')">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</section>

@if (Context.Session.GetInt32("AdminID") != null)
{
    <div class="modal fade" id="kayipDuzenleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content border-0">
                <form action="/Kayiplar/KayitGuncelle" method="post" enctype="multipart/form-data" novalidate="novalidate">
                    <input type="hidden" name="Id" id="editId" />
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title">Kaydı Düzenle</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Ad Soyad</label>
                            <input type="text" name="AdSoyad" id="editAdSoyad" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Vefat Tarihi</label>
                            <input type="date" name="VefatTarihiInput" id="editVefatTarihi" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Fotoğrafı Değiştir (İsteğe bağlı)</label>
                            <input type="file" name="Fotograf" class="form-control" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Açıklama</label>
                            <textarea name="Aciklama" id="editAciklama" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Vazgeç</button>
                        <button type="submit" class="btn btn-warning px-4">Güncelle</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="kayipEkleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/Kayiplar/KayitEkle" method="post" enctype="multipart/form-data">
                    <div class="modal-header bg-dark text-white">
                        <h5 class="modal-title">Yeni Kayıt Ekle</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Ad Soyad</label>
                            <input type="text" name="AdSoyad" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Vefat Tarihi</label>
                            <input type="date" name="VefatTarihiInput" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fotoğraf</label>
                            <input type="file" name="Fotograf" class="form-control" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kısa Açıklama / Not</label>
                            <textarea name="Aciklama" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-dark w-100">Kaydet</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

<style>
    /* CSS kodların aynen korunuyor */
    .memorial-card {
        transition: all 0.4s ease;
        border-radius: 15px;
        overflow: hidden;
    }

        .memorial-card:hover {
            transform: translateY(-10px);
        }

    .img-wrapper {
        height: 250px;
        overflow: hidden;
        background-color: #f8f9fa;
    }

    .memorial-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: grayscale(100%); /* Saygılı bir hava için siyah beyaz */
        transition: 0.5s;
    }

    .memorial-card:hover .memorial-img {
        filter: grayscale(0%);
    }
    /* Mouse üzerine gelince renklenir */
</style>

<script>
    function kayipDuzenle(id, adSoyad, tarih, aciklama) {
        document.getElementById('editId').value = id;
        document.getElementById('editAdSoyad').value = adSoyad;
        document.getElementById('editVefatTarihi').value = tarih; // yyyy-MM-dd formatında gelmeli
        document.getElementById('editAciklama').value = aciklama;

        var editModal = new bootstrap.Modal(document.getElementById('kayipDuzenleModal'));
        editModal.show();
    }
</script>