@model List<DernekYonetim.Models.UyeListesiViewModel>

@{
    ViewData["Title"] = "Üye Listesi ve Aidat Takibi";
    Layout = "_Layout";
}

<style>
    /* Tablo Tasarımı */
    .table-container {
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
        background: white;
    }

    .main-row {
        cursor: pointer;
        transition: background-color 0.2s;
    }

        .main-row:hover {
            background-color: #f8f9fa;
        }

    /* Detay Satırı */
    .detail-row {
        display: none;
        background-color: #fcfcfc;
    }

    /* Aidat Etiketi */
    .badge-aidat {
        background-color: #e9ecef;
        color: #495057;
        border: 1px solid #ced4da;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-right: 3px;
        margin-bottom: 3px;
        display: inline-block;
    }

    .badge-yok {
        background-color: #fff3cd;
        color: #856404;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    .toggle-icon {
        transition: transform 0.3s;
    }

    .open .toggle-icon {
        transform: rotate(90deg);
    }
</style>

<section class="page-section" style="padding-top:100px;">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="section-heading text-uppercase">Üye Aidat Yönetimi</h2>
                <p class="text-muted">Üye aidatlarını görüntüleyin ve yeni ödeme girişi yapın.</p>
            </div>
            <div>
                <button class="btn btn-primary">
                    <i class="fa fa-plus"></i> Yeni Üye Ekle
                </button>
            </div>
        </div>

        <div class="table-container table-responsive">
            <table class="table table-bordered align-middle mb-0">
                <thead class="table-dark text-center">
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th>Üye No</th>
                        <th>Ad Soyad</th>
                        <th>Telefon</th>
                        <th>Meslek</th>
                        <th>Ödenen Aidatlar</th>
                        <th style="width: 280px;">Aidat Girişi (Yıl / Tutar)</th>
                        <th style="width: 100px;">İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr class="main-row" onclick="toggleRow(@item.UyeId)">
                            <td class="text-center"><i id="icon-@item.UyeId" class="fa fa-chevron-right toggle-icon text-muted"></i></td>
                            <td class="fw-bold">@item.UyeNo</td>
                            <td>
                                <div class="fw-bold">@item.AdSoyad</div>
                                @if (item.Vefat)
                                {
                                    <small class="text-danger fw-bold">(VEFAT)</small>
                                }
                            </td>
                            <td>@item.Telefon</td>
                            <td>@item.Meslek</td>

                            <td>
                                @if (item.OdenenAidatlar != null && item.OdenenAidatlar.Any())
                                {
                                    @foreach (var aidat in item.OdenenAidatlar)
                                    {
                                        <span class="badge-aidat">
                                            @aidat.Yil: @aidat.Tutar?.ToString("N0") TL
                                        </span>
                                    }
                                }
                                else
                                {
                                    <span class="badge-yok">Ödeme Yok</span>
                                }
                            </td>

                            <td onclick="event.stopPropagation()">
                                <form asp-action="AidatEkle" method="post" class="row g-1 align-items-center">
                                    <input type="hidden" name="uyeId" value="@item.UyeId" />
                                    <div class="col-4">
                                        <input type="number" name="yil" class="form-control form-control-sm text-center"
                                               placeholder="Yıl" value="@DateTime.Now.Year" required />
                                    </div>
                                    <div class="col-5">
                                        <input type="number" name="tutar" class="form-control form-control-sm text-center"
                                               placeholder="TL" required />
                                    </div>
                                    <div class="col-3">
                                        <button type="submit" class="btn btn-sm btn-success w-100">
                                            <i class="fa fa-save"></i>
                                        </button>
                                    </div>
                                </form>
                            </td>

                            <td class="text-center" onclick="event.stopPropagation()">
                                <button class="btn btn-sm btn-outline-warning"><i class="fa fa-edit"></i></button>
                                <button class="btn btn-sm btn-outline-danger"><i class="fa fa-trash"></i></button>
                            </td>
                        </tr>

                        <tr id="detail-@item.UyeId" class="detail-row">
                            <td colspan="8">
                                <div class="p-3">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">Kimlik Bilgileri</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li><strong>TC No:</strong> @item.TcKimlikNo</li>
                                                <li><strong>Doğum:</strong> @(item.DogumTarihi != null ? item.DogumTarihi.Value.ToString("dd.MM.yyyy") : "-") / @item.DogumYeri</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">Eğitim</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li>@item.Universite</li>
                                                <li>Mezuniyet: @item.MezuniyetYili</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">İletişim</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li>@item.Email</li>
                                                <li>@item.AdresTam</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">Diğer</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li><strong>Üyelik Tarihi:</strong> @item.UyelikTarihi.ToShortDateString()</li>
                                                <li><strong>Derbis:</strong> @item.DerbisDurumu</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</section>

<script>
    function toggleRow(id) {
        var detailRow = document.getElementById('detail-' + id);
        var icon = document.getElementById('icon-' + id);
        var mainRow = detailRow.previousElementSibling;

        if (detailRow.style.display === "table-row") {
            detailRow.style.display = "none";
            mainRow.classList.remove("open");
            icon.classList.remove("fa-chevron-down");
            icon.classList.add("fa-chevron-right");
        } else {
            detailRow.style.display = "table-row";
            mainRow.classList.add("open");
            icon.classList.remove("fa-chevron-right");
            icon.classList.add("fa-chevron-down");
        }
    }
</script>