@model List<DernekYonetim.Models.UyeListesiViewModel>

@{
    ViewData["Title"] = "Üye Listesi ve Aidat Takibi";
    Layout = "_Layout";
}

<style>
    /* Tablo Tasarımı */
    .table-container {
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
        background: white;
    }

    .main-row {
        cursor: pointer;
        transition: background-color 0.2s;
    }

        .main-row:hover {
            background-color: #f8f9fa;
        }

    /* Detay Satırı (Başlangıçta gizli) */
    .detail-row {
        display: none;
        background-color: #fcfcfc;
    }

    /* Durum Etiketleri */
    .badge-odendi {
        background-color: #d1e7dd;
        color: #0f5132;
        padding: 5px 10px;
        border-radius: 4px;
        font-weight: 600;
    }

    .badge-odenmedi {
        background-color: #f8d7da;
        color: #842029;
        padding: 5px 10px;
        border-radius: 4px;
        font-weight: 600;
    }

    .toggle-icon {
        transition: transform 0.3s;
    }

    .open .toggle-icon {
        transform: rotate(90deg);
    }
</style>

<section class="page-section" style="padding-top:100px;">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="section-heading text-uppercase">Üye Listesi</h2>
                <p class="text-muted">Üye detaylarını görmek için satıra tıklayınız.</p>
            </div>
            <div>
                <button class="btn btn-primary">
                    <i class="fa fa-plus"></i> Yeni Üye Ekle
                </button>
            </div>
        </div>

        <div class="table-container table-responsive">
            <table class="table table-bordered align-middle mb-0">
                <thead class="table-dark text-center">
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th>Üye No</th>
                        <th>Ad Soyad</th>
                        <th>Telefon</th>
                        <th>Meslek</th>
                        <th>Derbis</th>
                        <th>2025 Aidat</th>
                        <th>2026 Aidat</th>
                        <th>2027 Aidat</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr class="main-row" onclick="toggleRow(@item.UyeId)">
                            <td class="text-center"><i id="icon-@item.UyeId" class="fa fa-chevron-right toggle-icon text-muted"></i></td>
                            <td class="fw-bold">@item.UyeNo</td>
                            <td>
                                <div class="fw-bold">@item.AdSoyad</div>
                                @if (item.Vefat)
                                {
                                    <small class="text-danger fw-bold">(VEFAT)</small>
                                }
                            </td>
                            <td>@item.Telefon</td>
                            <td>@item.Meslek</td>
                            <td class="text-center">
                                @if (item.DerbisDurumu == "Evet" || item.DerbisDurumu == "Var")
                                {
                                    <span class="badge bg-success">Kayıtlı</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Kayıt Yok</span>
                                }
                            </td>

                            <td class="text-center">
                                @if (item.Aidat2025.OdendiMi)
                                {
                                    <span class="badge-odendi">@item.Aidat2025.Tutar?.ToString("N0") TL</span>
                                }
                                else
                                {
                                    <span class="badge-odenmedi">Ödenmedi</span>
                                }
                            </td>

                            <td class="text-center">
                                @if (item.Aidat2026.OdendiMi)
                                {
                                    <span class="badge-odendi">@item.Aidat2026.Tutar?.ToString("N0") TL</span>
                                }
                                else
                                {
                                    <span class="badge-odenmedi">Ödenmedi</span>
                                }
                            </td>

                            <td class="text-center">
                                @if (item.Aidat2027.OdendiMi)
                                {
                                    <span class="badge-odendi">@item.Aidat2027.Tutar?.ToString("N0") TL</span>
                                }
                                else
                                {
                                    <span class="badge-odenmedi">Ödenmedi</span>
                                }
                            </td>

                            <td class="text-center">
                                <button class="btn btn-sm btn-outline-warning" onclick="event.stopPropagation()">
                                    <i class="fa fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation()">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </td>
                        </tr>

                        <tr id="detail-@item.UyeId" class="detail-row">
                            <td colspan="10">
                                <div class="p-3">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">Kimlik Bilgileri</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li><strong>TC No:</strong> @item.TcKimlikNo</li>
                                                <li><strong>Doğum Tarihi:</strong> @item.DogumTarihi</li>
                                                <li><strong>Doğum Yeri:</strong> @item.DogumYeri</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">Eğitim Bilgileri</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li><strong>Üniversite:</strong> @item.Universite</li>
                                                <li><strong>Mezuniyet Yılı:</strong> @item.MezuniyetYili</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">İletişim Bilgileri</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li><strong>Email:</strong> @item.Email</li>
                                                <li><strong>Adres:</strong> @item.AdresTam</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-3">
                                            <h6 class="text-primary fw-bold">Diğer</h6>
                                            <ul class="list-unstyled text-muted small">
                                                <li><strong>Üyelik Tarihi:</strong> @item.UyelikTarihi</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</section>

<script>
    function toggleRow(id) {
        var detailRow = document.getElementById('detail-' + id);
        var icon = document.getElementById('icon-' + id);
        var mainRow = detailRow.previousElementSibling;

        if (detailRow.style.display === "table-row") {
            detailRow.style.display = "none";
            mainRow.classList.remove("open");
            icon.classList.remove("fa-chevron-down");
            icon.classList.add("fa-chevron-right");
        } else {
            detailRow.style.display = "table-row";
            mainRow.classList.add("open");
            icon.classList.remove("fa-chevron-right");
            icon.classList.add("fa-chevron-down");
        }
    }
</script>